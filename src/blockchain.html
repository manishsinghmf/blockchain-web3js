<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Blockchain dApp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        h2 {
            color: #444;
        }

        form {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        input,
        button {
            padding: 10px;
            margin: 5px;
        }

        button {
            cursor: pointer;
        }

        #result {
            margin-top: 20px;
            padding: 10px;
            background: #f9f9f9;
            border: 1px solid #ddd;
        }
    </style>
</head>

<body>
    <h1>Ethereum dApp</h1>

    <!-- Balance (Web3.js) -->
    <form id="balanceWeb3Form">
        <h2>Fetch Balance (Web3.js)</h2>
        <input type="text" id="balanceWeb3Address" placeholder="Enter ETH Address" required />
        <button type="submit">Get Balance</button>
    </form>

    <!-- Balance (Ethers.js) -->
    <form id="balanceEthersForm">
        <h2>Fetch Balance (Ethers.js)</h2>
        <input type="text" id="balanceEthersAddress" placeholder="Enter ETH Address" required />
        <button type="submit">Get Balance</button>
    </form>

    <!-- Send ETH (Web3.js) -->
    <form id="sendWeb3Form">
        <h2>Send ETH (Web3.js)</h2>
        <input type="text" id="sendWeb3To" placeholder="Receiver Address" required />
        <input type="text" id="sendWeb3Amount" placeholder="Amount in ETH" required />
        <button type="submit">Send</button>
    </form>

    <!-- Send ETH (Ethers.js) -->
    <form id="sendEthersForm">
        <h2>Send ETH (Ethers.js)</h2>
        <input type="text" id="sendEthersTo" placeholder="Receiver Address" required />
        <input type="text" id="sendEthersAmount" placeholder="Amount in ETH" required />
        <button type="submit">Send</button>
    </form>

    <!-- Results -->
    <div id="result"></div>

    <script>
        const apiUrl = 'http://localhost:4000';

        const setResult = (msg, error = false) => {
            document.getElementById('result').innerHTML =
                `<p style="color:${error ? 'red' : 'green'}">${msg}</p>`;
        };

        // Balance (Web3.js)
        document.getElementById('balanceWeb3Form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const address = document.getElementById('balanceWeb3Address').value;
            const res = await fetch(`${apiUrl}/web3/balance/${address}`);
            const data = await res.json();
            if (data.error) setResult(data.error, true);
            else setResult(`[Web3.js] Balance of ${data.address}: ${data.balance} ETH`);
        });

        // Balance (Ethers.js)
        document.getElementById('balanceEthersForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const address = document.getElementById('balanceEthersAddress').value;
            const res = await fetch(`${apiUrl}/ethers/balance/${address}`);
            const data = await res.json();
            if (data.error) setResult(data.error, true);
            else setResult(`[Ethers.js] Balance of ${data.address}: ${data.balance} ETH`);
        });

        // Send ETH (Web3.js)
        document.getElementById('sendWeb3Form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const to = document.getElementById('sendWeb3To').value;
            const amount = document.getElementById('sendWeb3Amount').value;
            try {
                const res = await fetch(`${apiUrl}/web3/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to, amount })
                });

                const data = await res.json();

                if (data.error) {
                    setResult(data.error, true);
                } else {
                    const details = data.details;
                    setResult(`
                    <h3>[Web3.js] Transaction Sent!</h3>
                    <p><b>Hash:</b> <a href="${data.explorer}" target="_blank">${data.txHash}</a></p>
                    <p><b>From:</b> ${details.from}</p>
                    <p><b>To:</b> ${details.to}</p>
                    <p><b>Value:</b> ${details.valueEth} ETH</p>
                    <p><b>Status:</b> ${details.status}</p>
                    <p><b>Block:</b> ${details.blockNumber}</p>
                    <p><b>Confirmations:</b> ${details.confirmations}</p>
                    <p><b>Gas Used:</b> ${details.gasUsed}</p>
                    <p><b>Gas Price:</b> ${details.gasPriceGwei} Gwei</p>
                    <p><b>Total Fee:</b> ${details.totalFeeEth} ETH</p>
                    <p><b>Timestamp:</b> ${details.timestamp}</p>
                `);
                }
            } catch (err) {
                setResult("Failed to send ETH: " + err.message, true);
            }
        });

        // Send ETH (Ethers.js)
        document.getElementById('sendEthersForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const to = document.getElementById('sendEthersTo').value;
            const amount = document.getElementById('sendEthersAmount').value;

            try {
                const res = await fetch(`${apiUrl}/ethers/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to, amount })
                });

                const data = await res.json();

                if (data.error) {
                    setResult(data.error, true);
                } else {
                    const details = data.details;
                    setResult(`
                    <h3>[Ethers.js] Transaction Sent!</h3>
                    <p><b>Hash:</b> <a href="${data.explorer}" target="_blank">${data.txHash}</a></p>
                    <p><b>From:</b> ${details.from}</p>
                    <p><b>To:</b> ${details.to}</p>
                    <p><b>Value:</b> ${details.valueEth} ETH</p>
                    <p><b>Status:</b> ${details.status}</p>
                    <p><b>Block:</b> ${details.blockNumber}</p>
                    <p><b>Confirmations:</b> ${details.confirmations}</p>
                    <p><b>Gas Used:</b> ${details.gasUsed}</p>
                    <p><b>Gas Price:</b> ${details.gasPriceGwei} Gwei</p>
                    <p><b>Total Fee:</b> ${details.totalFeeEth} ETH</p>
                    <p><b>Timestamp:</b> ${details.timestamp}</p>
                `);
                }
            } catch (err) {
                setResult("Failed to send ETH: " + err.message, true);
            }
        });
    </script>
</body>

</html>